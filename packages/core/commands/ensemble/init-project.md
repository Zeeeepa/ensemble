---
name: init-project
description: Initialize project with constitution, standards, and docs structure for AI-augmented development
version: 1.0.0
category: scaffolding
---

> **Usage:** Invoke `/init-project` from the project root to scaffold AI-augmented development infrastructure.
> Optional hints: "minimal" (skip prompts, use defaults), "force" (overwrite existing)

---

## User Input

```text
$ARGUMENTS
```

Examples:
- (no args) - Interactive mode with prompts
- "minimal" - Use detected defaults, minimal prompts
- "force" - Overwrite existing files

---

## Goals

- Detect existing project structure and technology stack
- Create `docs/standards/constitution.md` with project guardrails
- Set up `docs/PRD/` and `docs/TRD/` directories
- Configure `.gitignore` for state files
- Provide foundation for `/create-prd`, `/create-trd`, and `/implement-trd` workflows

---

## Outline

### Step 1: Environment Detection

1. **Check existing structures**
   - If `docs/standards/constitution.md` exists and not "force" mode: Report existing setup, offer to update
   - If `.specify/` exists: Detect speckit installation, offer migration
   - If `.agent-os/` exists: Detect agent-os patterns, incorporate

2. **Detect technology stack**
   Scan project files to auto-detect:

   | File Pattern | Detection |
   |--------------|-----------|
   | `package.json` | Node.js, extract framework from dependencies |
   | `Cargo.toml` | Rust |
   | `go.mod` | Go |
   | `requirements.txt`, `pyproject.toml` | Python |
   | `Gemfile` | Ruby |
   | `*.csproj`, `*.sln` | .NET |
   | `mix.exs` | Elixir |
   | `composer.json` | PHP |

   Extract from package.json/similar:
   - Framework: React, Vue, Angular, Next.js, NestJS, Express, Rails, Phoenix, etc.
   - Testing: Jest, Vitest, Pytest, RSpec, xUnit, Playwright, Cypress
   - Build tools: Webpack, Vite, esbuild, Turbopack

3. **Detect existing testing setup**
   - Check for test directories: `tests/`, `__tests__/`, `spec/`, `test/`
   - Check for test config: `jest.config.*`, `vitest.config.*`, `pytest.ini`, `.rspec`
   - Extract coverage configuration if present

### Step 2: Interactive Configuration (unless "minimal")

Use `AskUserQuestion` tool to gather:

1. **Project Identity**
   ```yaml
   Questions:
     - "What is the project name?" (default: directory name)
     - "Brief project description?" (1-2 sentences)
   ```

2. **Development Methodology**
   ```yaml
   Question: "What development methodology should be enforced?"
   Options:
     - "TDD (Test-Driven Development)" - Tests before code, RED-GREEN-REFACTOR
     - "Flexible" - No strict ordering, trust developer judgment
     - "Characterization-first" - For brownfield, add tests without changing code
   ```

3. **Quality Gates**
   ```yaml
   Question: "What test coverage targets?"
   Options:
     - "High (80% unit, 70% integration)" - Recommended for production systems
     - "Standard (60% unit, 50% integration)" - Balanced coverage
     - "Minimal (40% unit)" - Prototypes and MVPs
     - "Custom" - Specify your own targets
   ```

4. **Approval Requirements**
   ```yaml
   Question: "What changes should require explicit approval?"
   MultiSelect: true
   Options:
     - "Architecture changes" (default: selected)
     - "New dependencies" (default: selected)
     - "Database schema changes" (default: selected)
     - "Breaking API changes" (default: selected)
     - "Production deployments" (default: selected)
     - "Security-sensitive code"
   ```

### Step 3: Generate Constitution

Create `docs/standards/constitution.md` with the following structure:

```markdown
# Project Constitution: [Project Name]

> This document defines the non-negotiable standards, guardrails, and quality gates for AI-augmented development.
> Generated by `/init-project` on [date]. Edit to customize.

---

## 1. Core Principles

### Development Methodology: [Selected]
[Description based on selection]

### Non-Negotiable Rules
1. **No secrets in code** - All credentials via environment variables or secrets manager
2. **Input validation required** - Validate all external input at system boundaries
3. **Tests accompany features** - No feature is complete without tests
4. [Additional user-defined principles]

---

## 2. Tech Stack

### Languages & Frameworks
- **Primary Language:** [detected]
- **Framework:** [detected]
- **Runtime:** [detected version if available]

### Testing
- **Unit Testing:** [detected or specified]
- **Integration Testing:** [detected or specified]
- **E2E Testing:** [detected or specified]

### Build & Deploy
- **Build Tool:** [detected]
- **CI/CD:** [if detected]
- **Deployment Target:** [if detected]

---

## 3. Quality Gates (Definition of Done)

### Test Coverage Targets
- Unit Tests: ≥[X]%
- Integration Tests: ≥[Y]%

### Code Quality
- [ ] All acceptance criteria met
- [ ] Test coverage targets satisfied
- [ ] No critical/high security vulnerabilities
- [ ] Code review approved
- [ ] Documentation updated
- [ ] No linting errors

### Security Requirements
- [ ] Input validation at all entry points
- [ ] No hardcoded secrets or credentials
- [ ] Authentication/authorization verified (where applicable)
- [ ] OWASP Top 10 considerations addressed

---

## 4. Approval Requirements

The following changes require explicit user approval before implementation:

### Always Require Approval
[List based on user selections]

### No Approval Needed
- Reading files or searching code
- Running tests (non-destructive)
- Creating new files in appropriate locations
- Adding tests or documentation
- Development server operations
- Git operations (status, diff, log, add, commit)

---

## 5. Agent Delegation Standards

### Specialist Priority
When delegating implementation work:
1. Use framework-specific specialists when available (e.g., `rails-backend-expert`, `react-component-architect`)
2. Fall back to general specialists (`backend-developer`, `frontend-developer`)
3. Use `general-purpose` only for research, not implementation

### Quality Validation
Every implementation must pass through:
1. `test-runner` for coverage validation
2. `code-reviewer` for security and quality
3. `playwright-tester` for E2E (when applicable)

---

## Changelog

| Date | Change | Author |
|------|--------|--------|
| [today] | Initial constitution generated | /init-project |
```

### Step 4: Create Directory Structure

```bash
# Create directories
mkdir -p docs/standards
mkdir -p docs/PRD
mkdir -p docs/TRD/completed

# Create placeholder READMEs (optional, brief)
```

Create `docs/PRD/.gitkeep` and `docs/TRD/.gitkeep` if directories are empty.

### Step 5: Update .gitignore

Append to `.gitignore` if not already present:

```gitignore
# TRD Implementation State
.trd-state/
```

### Step 6: Completion Report

Output summary:

```
Project initialized for AI-augmented development

Created:
  docs/standards/constitution.md  - Project guardrails and quality gates
  docs/PRD/                       - Product Requirements Documents
  docs/TRD/                       - Technical Requirements Documents
  docs/TRD/completed/             - Archived completed TRDs

Updated:
  .gitignore                      - Added .trd-state/ exclusion

Next steps:
  1. Review docs/standards/constitution.md and customize as needed
  2. Create a PRD with /create-prd for new features
  3. Generate TRD with /create-trd from approved PRD
  4. Implement with /implement-trd

Tech stack detected:
  [summary of detected stack]
```

---

## Migration from Existing Structures

### From speckit (.specify/)

If `.specify/memory/constitution.md` exists:
1. Read existing constitution
2. Merge principles and quality gates into new format
3. Preserve custom rules and tech stack
4. Offer to keep or remove `.specify/` structure

### From agent-os (.agent-os/)

If `.agent-os/product/tech-stack.md` exists:
1. Extract tech stack definitions
2. Incorporate into constitution
3. Keep `.agent-os/` for other purposes (specs, roadmap)

---

## Error Handling

- **Not a git repository**: Warn but continue (state tracking still works)
- **No package files found**: Prompt for manual tech stack entry
- **Write permission denied**: Report and suggest running with appropriate permissions
- **Existing constitution**: In non-force mode, show diff and ask to merge or skip

---

## Notes

- Constitution is a living document - encourage regular updates
- Tech stack detection is best-effort; manual review recommended
- Quality gates can be adjusted as project matures
- This command is idempotent in "force" mode
